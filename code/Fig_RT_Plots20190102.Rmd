---
title: "RT_Plots_Jia_01022019"
author: "Weiyan"
date: "1/2/2019"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Note: all the following data sets were generated by Lu Liu through R anlaysis.

# 1. Data input
```{r}
setwd("/Users/weiyanjia/Desktop/Randal S. Tibbetts/FUS project/Bioinfo_analysis/FUS_Replication timing/Replication timing_08312018/01_02_normalization_smoothing/plots_Jia/01022019")
library(RColorBrewer)
RT_Loess <- read.delim("all_sample_r1_r2_smooth.txt", header = TRUE, sep ="\t", stringsAsFactors = FALSE)
RT_Loess[, c(2:3)] <- sapply(RT_Loess[, c(2:3)], as.integer)
head(RT_Loess)

chr_list<-c()
for (i in 1:22){
  chr_list[i] <- paste0("chr",i,sep="")
  print(chr_list)
}

chr_list<-c(chr_list,"chrX")

RT_Loess$chr <- factor(RT_Loess$chr, levels= chr_list)

# write.table(RT_Loess,"RT_Loess_x.txt", sep="\t", row.names=FALSE, quote=FALSE, col.names = TRUE)
```

# 2. boxplots of timing values
```{r fig.height=8, fig.width=8}
library(reshape2)
dat.m <- melt(RT_Loess, id.vars='chr', measure.vars =c("U2OS_R1", "Clone110_R1","FUSClone110_R1","U2OS_R2","Clone110_R2","FUSClone110_R2") )

library(ggpubr)
ggboxplot(dat.m, x="variable", y="value",
         ylab = "Replication Timing", 
         ylim=c(-4,4),
         xlab ="",
         legend.title ="",
         x.text.angle = 45,
         color = "variable", palette = "aaas"
         )+
  border(color ="black", size =1, linetype = NULL)
palette = "aaas"

```
# 3. replication timing profile 

## 3.1 RT-Chr18-R1
```{r fig.height=4, fig.width=8}
sub_chr <- subset(RT_Loess, RT_Loess$chr == "chr18")
head(sub_chr)
class(sub_chr)

ggline(sub_chr, x="start", y=c("U2OS_R1", "Clone110_R1","FUSClone110_R1"),
       merge = TRUE,
         ylab = "Replication Timing", 
         ylim=c(-2,2),
         xlim = c(2e+07,5e+07),
         xlab ="Coordinate",
         plot_type = "l",
          palette = "aaas") +
  geom_hline(yintercept =0, linetype =2) +
  xscale("none", .format = TRUE)+
  border(color ="black", size =1, linetype = NULL)

```

##3.2 RT-Chr18-R2

```{r}
ggline(sub_chr, x="start", y=c("U2OS_R2", "Clone110_R2","FUSClone110_R2"),
       merge = TRUE,
         ylab = "Replication Timing", 
         ylim=c(-2,2),
         xlim = c(2e+07,5e+07),
         xlab ="Coordinate",
         plot_type = "l",
          palette = "aaas") +
  geom_hline(yintercept =0, linetype =2) +
  xscale("none", .format = TRUE)+
  border(color ="black", size =1, linetype = NULL)

```

# 4. RT Density distribution plot

## 4.1 Density distribution of R1_all_chr
```{r fig.height=4, fig.width=6}
ggdensity(RT_Loess, x = c("U2OS_R1", "Clone110_R1","FUSClone110_R1"), 
          y="..density..",
          xlim = c(-3,3),
          xlab = "Replication Timing",
          merge = TRUE,
          add = "median",                  # Add median line. 
         palette = "aaas"
         )+
  scale_x_continuous(expand = c(0, 0)) +
  scale_y_continuous(expand = c(0, 0))

```

## 4.2 Density distribution of R2_all_chr
```{r fig.height=4, fig.width=6}
ggdensity(RT_Loess, x = c("U2OS_R2", "Clone110_R2","FUSClone110_R2"), 
          y="..density..",
          xlim = c(-3,3),
          xlab = "Replication Timing",
          merge = TRUE,
          add = "median",                  # Add median line. 
         palette = "aaas"
         )+
  scale_x_continuous(expand = c(0, 0)) +
  scale_y_continuous(expand = c(0, 0))

```

## 4.3 Density distribution of R2_single_chr2
```{r fig.height=4, fig.width=6}
sub_chr <- subset(RT_Loess, RT_Loess$chr == "chr2")
ggdensity(sub_chr, x = c("U2OS_R2", "Clone110_R2","FUSClone110_R2"), 
          y="..density..",
          xlim = c(-3,3),
          xlab = "Replication Timing",
          merge = TRUE,
          add = "median",                  # Add median line. 
          # rug = TRUE , 
         palette = "aaas"
         )+
  scale_x_continuous(expand = c(0, 0)) +
  scale_y_continuous(expand = c(0, 0))
```

## 4.4 Density distribution of R2_single_chr5
```{r fig.height=4, fig.width=6}
sub_chr <- subset(RT_Loess, RT_Loess$chr == "chr5")
ggdensity(sub_chr, x = c("U2OS_R2", "Clone110_R2","FUSClone110_R2"), 
          y="..density..",
          xlim = c(-3,3),
          xlab = "Replication Timing",
          merge = TRUE,
          add = "median",                  # Add median line. 
         palette = "aaas"
         )+
  scale_x_continuous(expand = c(0, 0)) +
  scale_y_continuous(expand = c(0, 0))
```

## 4.5 Density distribution of R2_single_chr20
```{r fig.height=4, fig.width=6}
sub_chr <- subset(RT_Loess, RT_Loess$chr == "chr20")
ggdensity(sub_chr, x = c("U2OS_R2", "Clone110_R2","FUSClone110_R2"), 
          y="..density..",
          xlim = c(-3,3),
          xlab = "Replication Timing",
          merge = TRUE,
          add = "median",                  # Add median line. 
          # rug = TRUE , 
         palette = "aaas"
         )+
  scale_x_continuous(expand = c(0, 0)) +
  scale_y_continuous(expand = c(0, 0))
``` 

## 4.3 Density distribution of R1_single_chr2
```{r fig.height=4, fig.width=6}
sub_chr <- subset(RT_Loess, RT_Loess$chr == "chr2")
ggdensity(sub_chr, x = c("U2OS_R1", "Clone110_R1","FUSClone110_R1"), 
          y="..density..",
          xlim = c(-3,3),
          xlab = "Replication Timing",
          merge = TRUE,
          add = "median",                  # Add median line. 
          # rug = TRUE , 
         palette = "aaas"
         )+
  scale_x_continuous(expand = c(0, 0)) +
  scale_y_continuous(expand = c(0, 0))
```

## 4.4 Density distribution of R1_single_chr5
```{r fig.height=4, fig.width=6}
sub_chr <- subset(RT_Loess, RT_Loess$chr == "chr5")
ggdensity(sub_chr, x = c("U2OS_R1", "Clone110_R1","FUSClone110_R1"), 
          y="..density..",
          xlim = c(-3,3),
          xlab = "Replication Timing",
          merge = TRUE,
          add = "median",                  # Add median line. 
         palette = "aaas"
         )+
  scale_x_continuous(expand = c(0, 0)) +
  scale_y_continuous(expand = c(0, 0))
```

## 4.5 Density distribution of R1_single_chr20
```{r fig.height=4, fig.width=6}
sub_chr <- subset(RT_Loess, RT_Loess$chr == "chr20")
ggdensity(sub_chr, x = c("U2OS_R1", "Clone110_R1","FUSClone110_R1"), 
          y="..density..",
          xlim = c(-3,3),
          xlab = "Replication Timing",
          merge = TRUE,
          add = "median",                  # Add median line. 
          # rug = TRUE , 
         palette = "aaas"
         )+
  scale_x_continuous(expand = c(0, 0)) +
  scale_y_continuous(expand = c(0, 0))
``` 

# 5. correlection-heatmap plot

```{r fig.height=6, fig.width=6}
library(ComplexHeatmap)
library(circlize)
corr_data <- RT_Loess[4:ncol(RT_Loess)]
corr_matrix <- round(cor(corr_data, method = "pearson"), 2)
col_fun = colorRamp2(c(0.6, 0.8, 1), c("#4DAF4A", "#FFD92F", "#E41A1C"))

Heatmap(corr_matrix, name = "", col = col_fun,
        row_names_side = "left",
        row_order = c("U2OS_R1","U2OS_R2","FUSClone110_R1","FUSClone110_R2",
                      "Clone110_R1","Clone110_R2"),
        column_order = c("U2OS_R1","U2OS_R2","FUSClone110_R1","FUSClone110_R2",
                         "Clone110_R1","Clone110_R2"),
    # column_order = c("Clone110_S_R2","Clone110_S_R1","FUSClone110_S_R2","FUSClone110_S_R1",
                       #"U2OS_S_R2","U2OS_S_R1"),
    # column_order = rev(order(colnames(corr_matrix))),
      clustering_distance_rows = "pearson",
      clustering_distance_columns = "pearson",
      cluster_rows = FALSE,
      cluster_columns = FALSE,
      cell_fun = function(j, i, x, y, width, height, fill) {
      grid.text(sprintf("%.2f", corr_matrix[i, j]), x, y, gp = gpar(fontsize = 10))
      },
      heatmap_legend_param = list(
      at = c(0.6,0.7, 0.8,0.9, 1.0),
     legend_height = unit(4.5, "inch"),
     title_position = "topleft")
    )
```


# 6 Histogram plots of RT difference
```{r}
RT_Loess$diff_U2OS_Clone110_R1 <- RT_Loess$Clone110_R1 - RT_Loess$U2OS_R1
RT_Loess$diff_U2OS_FUSClone110_R1 <- RT_Loess$FUSClone110_R1 - RT_Loess$U2OS_R1
RT_Loess$diff_U2OS_Clone110_R2 <- RT_Loess$Clone110_R2 - RT_Loess$U2OS_R2
RT_Loess$diff_U2OS_FUSClone110_R2 <- RT_Loess$FUSClone110_R2 - RT_Loess$U2OS_R2

head(RT_Loess)
```

## 6.1 R1

```{r fig.height=6, fig.width=6}
gghistogram(RT_Loess, x = c("diff_U2OS_FUSClone110_R1", "diff_U2OS_Clone110_R1"), 
          y="..count..",
          position = "dodge",
          xlim = c(-3,3),
          bins = 50,
          xlab = "Replication Timing",
          color = ".x.", 
          fill = ".x.",
          merge = TRUE,
          add = "median",                # Add median line. 
         palette = "aaas"
         )+
  scale_x_continuous(expand = c(0, 0)) +
  scale_y_continuous(expand = c(0, 0))
```
## 6.1 R2

```{r fig.height=6, fig.width=6}
gghistogram(RT_Loess, x = c("diff_U2OS_FUSClone110_R2","diff_U2OS_Clone110_R2"), 
          y="..count..",
          position = "dodge",
          xlim = c(-3,3),
          bins = 100,
          xlab = "Replication Timing",
          color = ".x.", fill = ".x.",
          merge = TRUE,
          add = "median",                  # Add median line. 
         palette = "aaas"
         )+
  scale_x_continuous(expand = c(0, 0)) +
  scale_y_continuous(expand = c(0, 0)) 
```

# 7. Plot whole chromosomes RT data

## 7.1 facet_grid of RT
```{r}
p <- ggline(RT_Loess, x="start", y=c("U2OS_R2", "Clone110_R2","FUSClone110_R2"),
       merge = TRUE,
       size= 0.5,
         ylab = "Replication Timing", 
         ylim=c(-3,3),
         xlab ="Coordinate",
         plot_type = "l",
          palette = "aaas") +
  geom_hline(yintercept =0, linetype =2) +
  xscale("none", .format = TRUE)+
  border(color ="black", size =0.5, linetype = NULL)+
  scale_x_continuous(expand = c(0, 0)) +
  scale_y_continuous(expand = c(0, 0), breaks = c(-2,-1, 0, 1, 2))

p + facet_grid(rows = vars(chr), scales = "free", space = "free", margins = FALSE, shrink = TRUE)+
theme(panel.spacing = unit(0.1, "lines"),
      panel.border = element_rect(linetype ="solid", fill = NA)) 

```


## 7.2 RT plot of R2

```{r fig.height=4, fig.width=15}
library(ggsci)
## palette from package ggsci

palette1 <- pal_aaas("default")(10)
# palette1

palette2 <- pal_npg("nrc")(10)
# palette2

palette3 <- pal_lancet("lanonc")(9)
# palette3

big_palette <- c(palette1,palette2,palette3)
# big_palette

big_palette_clean <- big_palette[!duplicated(big_palette)]

# big_palette_clean

p <- ggline(RT_Loess, x="start", y="U2OS_R2",
       merge = TRUE,
       size = 0.5,
         ylab = "Replication Timing", 
         ylim=c(-3,3),
         #xlim = c(0.0e+00,2.6e+08),
         xlab ="Chromosome",
         plot_type = "l",
         color = "chr",
         palette = big_palette_clean) +
  geom_hline(yintercept =0, linetype =2) +
  xscale("none", .format = TRUE)+
  border(color ="black", size =0.5, linetype = NULL)+
  scale_x_continuous(expand = c(0, 0)) +
  scale_y_continuous(expand = c(0, 0), breaks = c(-2,-1, 0, 1, 2)) +
  theme (
    axis.text.x = element_blank(),
    axis.ticks.x = element_blank()
    )

p + facet_grid(cols = vars(chr), scales = "free", space = "free", drop = TRUE, margins = FALSE, shrink = TRUE, switch = "x") +
   theme(panel.spacing = unit(0, "lines")) 

```

```{r}
sessionInfo()
```

